<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vocabulary Chase - Elite Academic Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --retro-font: 'Press Start 2P', cursive;
        }

        body {
            background-color: #050505;
            color: #ffffff;
            font-family: var(--retro-font);
            margin: 0;
            overflow: hidden;
            touch-action: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .arcade-text {
            text-shadow: 3px 3px #ff0000, -2px -2px #0000ff;
        }

        .road {
            position: relative;
            height: 160px;
            background: #111;
            border-top: 4px solid #444;
            border-bottom: 4px solid #444;
            overflow: hidden;
            display: flex;
            align-items: center;
        }

        .road-lines {
            position: absolute;
            width: 200%;
            height: 6px;
            background: repeating-linear-gradient(90deg, transparent, transparent 40px, #aaa 40px, #aaa 80px);
            animation: moveRoad 0.6s linear infinite;
        }

        @keyframes moveRoad {
            from { transform: translateX(0); }
            to { transform: translateX(-80px); }
        }

        .paused .road-lines {
            animation-play-state: paused;
        }

        .chase-lane {
            position: relative;
            width: 100%;
            height: 80px;
            margin: 0 auto;
            max-width: 1000px;
        }

        .vehicle {
            position: absolute;
            font-size: 3.5rem;
            top: 50%;
            transform: translateY(-50%) scaleX(-1);
            z-index: 10;
            will-change: left;
        }

        #police-car { left: 5%; }
        #player-bike { left: 80%; }

        .game-card {
            background: linear-gradient(180deg, #1a1a1a 0%, #0a0a0a 100%);
            border: 4px solid #fff;
            box-shadow: 6px 6px 0px #ff0000;
        }

        .btn-option {
            background: #222;
            border: 2px solid #555;
            padding: 0.8rem;
            text-align: left;
            font-size: 0.6rem;
            transition: all 0.1s ease;
            cursor: pointer;
            border-radius: 4px;
            min-height: 90px;
            display: flex;
            align-items: center;
            line-height: 1.4;
            font-family: 'Segoe UI', sans-serif;
            font-weight: 600;
        }

        .btn-option:active {
            background: #fff;
            color: #000;
            transform: translateY(2px);
        }

        .timer-container {
            height: 14px;
            background: #333;
            border: 2px solid #fff;
            width: 100%;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }

        #timer-bar {
            height: 100%;
            width: 100%;
            background: #00ff00;
            transform-origin: left;
        }

        .screen { display: none; height: 100vh; width: 100vw; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .screen.active { display: flex; }

        .busted-flash {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 0, 0, 0.6); display: none;
            justify-content: center; align-items: center; z-index: 100;
            animation: flash 0.1s infinite;
        }

        @keyframes flash { 0% { opacity: 0.4; } 50% { opacity: 0.8; } 100% { opacity: 0.4; } }

        #audio-toggle {
            position: fixed; top: 20px; right: 20px; font-size: 10px;
            cursor: pointer; background: #000; border: 2px solid #fff; padding: 8px;
            z-index: 1000;
        }

        .pdf-btn {
            position: fixed; bottom: 20px; right: 20px; font-size: 8px;
            cursor: pointer; background: #111; color: #666; padding: 10px;
            border: 1px solid #444; border-radius: 4px; z-index: 1000;
        }
        .pdf-btn:hover { color: #fff; border-color: #fff; }
    </style>
</head>
<body class="flex items-center justify-center">

    <div id="audio-toggle" onclick="toggleAudio()">üîä AUDIO: ON</div>

    <!-- START SCREEN -->
    <div id="start-screen" class="screen active text-center">
        <h1 class="text-2xl md:text-5xl mb-8 arcade-text leading-tight">VOCABULARY<br>CHASE</h1>
        <div class="mb-8 text-[9px] md:text-xs space-y-4 max-w-2xl px-4 leading-relaxed">
            <p>Advanced Academic Pursuit: British Empire, South Africa, and Canada Modules.</p>
            <p class="text-blue-400 uppercase">Adaptive Speed: Starts at 10s, accelerates to 4s as you level up.</p>
            <p class="text-green-400 uppercase">System: Your progress is tracked. No repeated terms.</p>
        </div>
        <div class="mb-6">
            <p class="text-[10px]">HIGHSCORE: <span id="display-highscore">0</span></p>
            <p class="text-[9px] mt-2 text-green-400">SESSION MASTERY: <span id="progress-text">0/0</span> TERMS</p>
        </div>
        <button onclick="startGame()" class="bg-blue-600 hover:bg-blue-500 text-white px-12 py-6 border-b-8 border-blue-900 active:border-b-0 text-sm">LAUNCH SESSION</button>
        <div class="mt-8 text-[8px] text-gray-600 cursor-pointer underline" onclick="resetProgress()">Clear learning history</div>
    </div>

    <!-- GAME SCREEN -->
    <div id="game-screen" class="screen">
        <div class="w-full max-w-5xl">
            <div class="road mb-6 rounded-lg" id="road-element">
                <div class="road-lines"></div>
                <div class="chase-lane">
                    <div id="police-car" class="vehicle">üöì</div>
                    <div id="player-bike" class="vehicle">üèçÔ∏è</div>
                </div>
            </div>

            <div class="flex justify-between items-end mb-4 px-2">
                <div class="text-[9px] text-green-400">SCORE: <span id="current-score">0</span></div>
                <div class="text-[9px] text-yellow-400">TIME: <span id="current-duration-display">10.0</span>s</div>
                <div class="text-[9px] text-blue-400">LVL: <span id="current-level">1</span></div>
            </div>

            <div class="game-card p-4 md:p-8">
                <div class="timer-container">
                    <div id="timer-bar"></div>
                </div>
                <div id="question-text" class="text-xs md:text-sm mb-6 leading-relaxed text-center min-h-[100px] flex items-center justify-center px-4">
                    Connecting to database...
                </div>
                <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
            </div>
        </div>
    </div>

    <!-- GAME OVER SCREEN -->
    <div id="game-over-screen" class="screen text-center">
        <h1 class="text-5xl text-red-600 mb-8 arcade-text">BUSTED!</h1>
        <div class="game-card p-10 mb-10 w-full max-w-md">
            <p class="mb-4 text-sm">SCORE: <span id="final-score" class="text-green-400">0</span></p>
            <p id="game-over-reason" class="text-red-400 text-[9px] leading-relaxed"></p>
        </div>
        <button onclick="restartGame()" class="bg-white text-black px-12 py-6 hover:bg-gray-200 text-sm">REBOOT</button>
    </div>

    <div id="busted-flash" class="busted-flash">
        <h2 class="text-4xl text-white arcade-text">CAUGHT!</h2>
    </div>

    <div class="pdf-btn" onclick="downloadPDF()">GENERATE STUDENT NOTES (PDF)</div>

    <script>
        // --- COMPREHENSIVE VOCABULARY DATABASE ---
        const vocabularyDB = [
            // Format 1: Question = Sentence with blank, Answers = Single Words
            // Format 2: Question = Single Word with colon, Answers = Full sentences/explanations
            { id: 1, type: 1, q: "The British Empire left a significant ________ that still influences global politics today.", a: "legacy", d: ["expansion", "inhabitant", "attempt"] },
            { id: 2, type: 2, q: "To assimilate:", a: "To absorb and integrate people into the customs and attitudes of a dominant group.", d: ["To set right an unfair situation or to correct a past injustice.", "To move to a new place and establish one's home there.", "To kill animals brutally for food or sport."] },
            { id: 3, type: 1, q: "Apartheid in South Africa was a notorious system based on racial ________.", a: "segregation", d: ["reconciliation", "prosperity", "inquiry"] },
            { id: 4, type: 2, q: "Aftermath:", a: "The consequences or aftereffects of a significant or disastrous event.", d: ["The middle value in a set of data arranged in order of size.", "A state of being firm, steady, and not likely to change.", "A long pipe used for carrying oil or gas over long distances."] },
            { id: 5, type: 1, q: "Nelson Mandela was ________ to stand trial for his role in the anti-apartheid movement.", a: "obliged", d: ["blessed", "determined", "nimble"] },
            { id: 6, type: 2, q: "Civil disobedience:", a: "The non-violent refusal to obey certain laws as a form of protest.", d: ["The exercise of control or influence over another group of people.", "A strong feeling of hostility, hate, or deep-seated resentment.", "The act of performing a crime, sin, or error."] },
            { id: 7, type: 1, q: "It is essential to ________ the suffering of marginalized groups in post-colonial societies.", a: "alleviate", d: ["quell", "hire", "dare"] },
            { id: 8, type: 2, q: "To maintain:", a: "To keep something at a stable, consistent, or constant level.", d: ["To change the form or character of something completely.", "To gather a crop or resource as a reward for labor.", "To cry noisily while taking short, sudden breaths of air."] },
            { id: 9, type: 1, q: "Indigenous communities often ________ their land rights in court against large industrial projects.", a: "claim", d: ["grant", "collapse", "return"] },
            { id: 10, type: 2, q: "Inequality:", a: "The unfair difference in status, rights, and opportunities between groups.", d: ["A state of being successful, flourishing, and wealthy.", "An official investigation conducted to determine the facts of a case.", "A formal, legally binding agreement made between sovereign states."] },
            { id: 11, type: 1, q: "The detective needed more ________ to prove that the suspect was guilty beyond doubt.", a: "evidence", d: ["treaty", "inquiry", "fine"] },
            { id: 12, type: 2, q: "Exasperated:", a: "Intensely irritated or frustrated to a very high degree.", d: ["Quick and light in movement or action; agile.", "Firmly fixed and not likely to give way or overturn.", "Prepared or ready to do something without pressure."] },
            { id: 13, type: 1, q: "The government launched an ________ into the disappearance of the ancient artifacts.", a: "inquiry", d: ["reform", "prohibition", "trial"] },
            { id: 14, type: 2, q: "To quell:", a: "To suppress or crush a rebellion or an uprising by force.", d: ["To arrange or plan something in a clever or tricky way.", "To remedy or set right an undesirable or unfair situation.", "To move from one region or habitat to another, often for work."] },
            { id: 15, type: 1, q: "Despite the market ________, the entrepreneurs refused to give up on their project.", a: "collapse", d: ["merchant", "timber", "median"] },
            { id: 16, type: 2, q: "Reconciliation:", a: "The restoration of friendly relations between formerly hostile groups.", d: ["The act of making a territory or business larger.", "The pointless or useless state of a specific action or effort.", "A period of ten years in the history of a nation."] },
            { id: 17, type: 1, q: "She prides herself on her ________ fingers, which allow her to play the piano perfectly.", a: "nimble", d: ["resistant", "stable", "equal"] },
            { id: 18, type: 2, q: "To cherish:", a: "To protect and care for something lovingly or to hold it dear.", d: ["To describe someone in a particular way in literature.", "To rush forward suddenly in order to attack someone.", "To be worthy of something due to actions or qualities."] },
            { id: 19, type: 1, q: "The country ________ a war against its neighbor for nearly a whole decade.", a: "waged", d: ["quelled", "contrived", "redressed"] },
            { id: 20, type: 2, q: "Expatriate:", a: "A person who lives and works outside their native country.", d: ["A woman whose husband has died and who has not remarried.", "A regular customer or visitor of a theater or restaurant.", "A person who buys and sells goods in large quantities."] },
            { id: 21, type: 1, q: "The dictator was trying to ________ the revolution by all means necessary.", a: "quell", d: ["maintain", "alleviate", "return"] },
            { id: 22, type: 2, q: "Prosperous:", a: "Successful in material terms; flourishing financially.", d: ["Happening only a short while ago; very recent.", "Made by human beings rather than occurring naturally.", "Having the ability or power to do something specific."] },
            { id: 23, type: 1, q: "The Archbishop ________ the mayor as a corrupt and dangerous individual.", a: "portrayed", d: ["negotiated", "classified", "obtained"] },
            { id: 24, type: 2, q: "Futility:", a: "The pointlessness or uselessness of a specific action or effort.", d: ["The act of becoming larger or more extensive.", "A formal examination of evidence in a court of law.", "An improvement or amendment of what is wrong."] },
            { id: 25, q: "Translate 'Entschuldigung':", a: "apology", d: ["excuse", "reason", "feeling"], type: 1 },
            { id: 26, q: "To redress:", a: "To remedy or set right an undesirable or unfair situation.", d: ["To provide money for a specific project or cause.", "To say what will happen in the future.", "To keep something at a steady and consistent level."], type: 2 }
        ];

        // --- GAME STATE ---
        let score = 0;
        let highscore = localStorage.getItem('vocaChaseHighscore') || 0;
        let usedIds = JSON.parse(localStorage.getItem('vocaUsedIds')) || [];
        let mistakeLog = JSON.parse(localStorage.getItem('vocaMistakes')) || [];
        let isMuted = false;
        let gameActive = false;
        
        let startTime = 0;
        let animationFrameId = null;

        const POLICE_START_X = 5;
        const TARGET_X = 80;

        let audioCtx = null;
        let masterGain = null;

        function getCurrentDuration() {
            const level = Math.floor(score / 1000) + 1;
            return Math.max(4000, 10000 - (level - 1) * 500);
        }

        function init() {
            document.getElementById('display-highscore').innerText = highscore;
            updateProgress();
        }

        function updateProgress() {
            document.getElementById('progress-text').innerText = `${usedIds.length}/${vocabularyDB.length}`;
        }

        function resetProgress() {
            if(!confirm("Are you sure? Highscore remains, but progress clears.")) return;
            usedIds = [];
            mistakeLog = [];
            localStorage.setItem('vocaUsedIds', JSON.stringify([]));
            localStorage.setItem('vocaMistakes', JSON.stringify([]));
            updateProgress();
            location.reload();
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            const target = document.getElementById(id + '-screen');
            if(target) target.classList.add('active');
        }

        function startGame() {
            initAudio();
            score = 0;
            updateScoreUI();
            showScreen('game');
            gameActive = true;
            document.getElementById('road-element').classList.remove('paused');
            nextQuestion();
        }

        function nextQuestion() {
            let available = vocabularyDB.filter(item => !usedIds.includes(item.id));
            if (available.length === 0) {
                usedIds = [];
                available = [...vocabularyDB];
            }

            const q = available[Math.floor(Math.random() * available.length)];
            usedIds.push(q.id);
            localStorage.setItem('vocaUsedIds', JSON.stringify(usedIds));
            updateProgress();

            document.getElementById('question-text').innerText = q.q;
            document.getElementById('current-duration-display').innerText = (getCurrentDuration()/1000).toFixed(1);
            
            const options = [...q.d, q.a];
            for (let i = options.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [options[i], options[j]] = [options[j], options[i]];
            }
            
            const grid = document.getElementById('options-grid');
            grid.innerHTML = '';
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'btn-option';
                btn.innerText = opt;
                // Change font for single word answers to match arcade look, sans-serif for sentences
                btn.style.fontFamily = opt.split(' ').length > 4 ? 'Segoe UI' : '"Press Start 2P"';
                btn.style.fontSize = opt.split(' ').length > 4 ? '0.7rem' : '0.5rem';

                btn.onclick = (e) => {
                    e.preventDefault();
                    if(gameActive) checkAnswer(opt, q);
                };
                grid.appendChild(btn);
            });

            startTimer();
        }

        function startTimer() {
            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            startTime = performance.now();
            tick();
        }

        function tick() {
            if (!gameActive) return;
            const now = performance.now();
            const elapsed = now - startTime;
            const currentDuration = getCurrentDuration();
            const progress = Math.min(elapsed / currentDuration, 1);

            const timerBar = document.getElementById('timer-bar');
            timerBar.style.transform = `scaleX(${1 - progress})`;
            
            if (progress < 0.5) timerBar.style.background = '#00ff00';
            else if (progress < 0.8) timerBar.style.background = '#ffff00';
            else timerBar.style.background = '#ff0000';

            const currentPoliceX = POLICE_START_X + (TARGET_X - POLICE_START_X) * progress;
            document.getElementById('police-car').style.left = currentPoliceX + '%';

            if (progress >= 1) {
                gameOver("TIMEOUT! THE PURSUIT ENDED IN A BUST.");
            } else {
                animationFrameId = requestAnimationFrame(tick);
            }
        }

        function checkAnswer(selected, qObj) {
            if (selected === qObj.a) {
                playNote(523, 'sine', 0.1); 
                const now = performance.now();
                const currentDuration = getCurrentDuration();
                const bonus = Math.floor((currentDuration - (now - startTime)) / 50);
                score += 100 + Math.max(0, bonus);
                updateScoreUI();
                nextQuestion();
            } else {
                playNote(110, 'sawtooth', 0.3); 
                mistakeLog.push({ question: qObj.q, correct: qObj.a });
                localStorage.setItem('vocaMistakes', JSON.stringify(mistakeLog));
                gameOver("WRONG OPTION! YOU CRASHED DURING THE CHASE.");
            }
        }

        function updateScoreUI() {
            document.getElementById('current-score').innerText = score;
            const level = Math.floor(score / 1000) + 1;
            document.getElementById('current-level').innerText = level;
            document.getElementById('current-duration-display').innerText = (getCurrentDuration()/1000).toFixed(1);
        }

        function gameOver(reason) {
            gameActive = false;
            cancelAnimationFrame(animationFrameId);
            document.getElementById('road-element').classList.add('paused');
            document.getElementById('busted-flash').style.display = 'flex';
            
            setTimeout(() => {
                document.getElementById('busted-flash').style.display = 'none';
                showScreen('game-over');
                if (score > highscore) {
                    highscore = score;
                    localStorage.setItem('vocaChaseHighscore', highscore);
                    document.getElementById('display-highscore').innerText = highscore;
                }
                document.getElementById('final-score').innerText = score;
                document.getElementById('game-over-reason').innerText = reason;
            }, 800);
        }

        function restartGame() { startGame(); }

        // --- AUDIO ENGINE ---
        function initAudio() {
            if (audioCtx) return;
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            masterGain = audioCtx.createGain();
            masterGain.connect(audioCtx.destination);
            masterGain.gain.value = 0.08;
            
            setInterval(() => {
                if (gameActive) {
                    playNote(82, 'triangle', 0.15, 0.4); 
                    setTimeout(() => playNote(73, 'triangle', 0.1, 0.2), 200); 
                }
            }, 400);
        }

        function playNote(freq, type, duration, vol = 0.5) {
            if (isMuted || !audioCtx) return;
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            g.gain.setValueAtTime(vol, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
            osc.connect(g);
            g.connect(masterGain);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function toggleAudio() {
            isMuted = !isMuted;
            document.getElementById('audio-toggle').innerText = isMuted ? "üîá AUDIO: OFF" : "üîä AUDIO: ON";
        }

        // --- PDF EXPORT ---
        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(22);
            doc.text("Vocabulary Chase - Performance Report", 20, 20);
            
            doc.setFontSize(12);
            doc.text(`Student Mastery Analysis`, 20, 35);
            doc.text(`Record Highscore: ${highscore}`, 20, 45);
            doc.text(`Terms Encountered: ${usedIds.length} / ${vocabularyDB.length}`, 20, 52);
            
            doc.setDrawColor(200, 200, 200);
            doc.line(20, 60, 190, 60);
            
            doc.setFontSize(14);
            doc.text("Personal Learning Notes (Mistakes):", 20, 70);
            
            let y = 80;
            if (mistakeLog.length === 0) {
                doc.setFontSize(11);
                doc.text("No mistakes recorded. Perfect session!", 20, y);
            } else {
                mistakeLog.forEach((item, index) => {
                    if (y > 270) { doc.addPage(); y = 20; }
                    doc.setFontSize(10);
                    doc.setTextColor(180, 0, 0);
                    doc.text(`Mistake #${index + 1}`, 20, y);
                    doc.setTextColor(0, 0, 0);
                    const splitQ = doc.splitTextToSize(`Question/Word: ${item.question}`, 160);
                    doc.text(splitQ, 25, y + 6);
                    y += (splitQ.length * 5) + 6;
                    const splitA = doc.splitTextToSize(`Correct: ${item.correct}`, 160);
                    doc.text(splitA, 25, y);
                    y += (splitA.length * 5) + 10;
                });
            }
            
            doc.save("Vocabulary_Chase_Learning_Notes.pdf");
        }

        init();
    </script>
</body>
</html>
