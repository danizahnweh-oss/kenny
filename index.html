<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vocabulary Chase - Elite Pursuit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --retro-font: 'Press Start 2P', cursive;
        }

        body {
            background-color: #050505;
            color: #ffffff;
            font-family: var(--retro-font);
            margin: 0;
            overflow: hidden;
            touch-action: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .arcade-text {
            text-shadow: 3px 3px #ff0000, -2px -2px #0000ff;
        }

        /* Animierte Retro-Stra√üe */
        .road {
            position: relative;
            height: 160px;
            background: #111;
            border-top: 4px solid #444;
            border-bottom: 4px solid #444;
            overflow: hidden;
            display: flex;
            align-items: center;
        }

        .road-lines {
            position: absolute;
            width: 200%;
            height: 6px;
            background: repeating-linear-gradient(90deg, transparent, transparent 40px, #aaa 40px, #aaa 80px);
            animation: moveRoad 0.6s linear infinite;
        }

        @keyframes moveRoad {
            from { transform: translateX(0); }
            to { transform: translateX(-80px); }
        }

        .paused .road-lines {
            animation-play-state: paused;
        }

        /* Fahrzeug-Styling */
        .chase-lane {
            position: relative;
            width: 100%;
            height: 80px;
            margin: 0 auto;
            max-width: 1000px;
        }

        .vehicle {
            position: absolute;
            font-size: 3.5rem;
            top: 50%;
            transform: translateY(-50%) scaleX(-1);
            z-index: 10;
            will-change: left;
        }

        #police-car { left: 0%; }
        #player-bike { left: 80%; }

        /* UI Komponenten */
        .game-card {
            background: linear-gradient(180deg, #1a1a1a 0%, #0a0a0a 100%);
            border: 4px solid #fff;
            box-shadow: 6px 6px 0px #ff0000;
        }

        .btn-option {
            background: #222;
            border: 2px solid #555;
            padding: 1.2rem;
            text-align: center;
            font-size: 0.65rem;
            transition: all 0.1s ease;
            cursor: pointer;
            border-radius: 4px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.4;
        }

        .btn-option:active {
            background: #fff;
            color: #000;
            transform: translateY(2px);
        }

        .timer-container {
            height: 24px;
            background: #333;
            border: 2px solid #fff;
            width: 100%;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        #timer-bar {
            height: 100%;
            width: 100%;
            background: #00ff00;
            transform-origin: left;
        }

        .screen { display: none; height: 100vh; width: 100vw; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .screen.active { display: flex; }

        .busted-flash {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 0, 0, 0.6); display: none;
            justify-content: center; align-items: center; z-index: 100;
            animation: flash 0.1s infinite;
        }

        @keyframes flash { 0% { opacity: 0.4; } 50% { opacity: 0.8; } 100% { opacity: 0.4; } }

        #audio-toggle {
            position: fixed; top: 20px; right: 20px; font-size: 10px;
            cursor: pointer; background: #000; border: 2px solid #fff; padding: 8px;
            z-index: 1000;
        }
    </style>
</head>
<body class="flex items-center justify-center">

    <div id="audio-toggle" onclick="toggleAudio()">üîä AUDIO: ON</div>

    <!-- STARTBILDSCHIRM -->
    <div id="start-screen" class="screen active text-center">
        <h1 class="text-3xl md:text-5xl mb-10 arcade-text leading-tight">VOCABULARY<br>CHASE</h1>
        <div class="mb-10 text-[10px] md:text-xs space-y-4 max-w-lg">
            <p>Abitur-Niveau Vokabeltraining</p>
            <p class="text-blue-400">ESCAPE THE POLICE BY ANSWERING CORRECTLY.</p>
            <p class="text-red-500">YOU HAVE EXACTLY 5 SECONDS PER QUESTION.</p>
        </div>
        <div class="mb-10">
            <p class="text-[10px]">RECORD: <span id="display-highscore">0</span></p>
        </div>
        <button onclick="startGame()" class="bg-blue-600 hover:bg-blue-500 text-white px-12 py-6 border-b-8 border-blue-900 active:border-b-0 text-sm">ENGAGE</button>
    </div>

    <!-- SPIELBILDSCHIRM -->
    <div id="game-screen" class="screen">
        <div class="w-full max-w-5xl">
            <div class="road mb-8 rounded-lg" id="road-element">
                <div class="road-lines"></div>
                <div class="chase-lane">
                    <div id="police-car" class="vehicle">üöì</div>
                    <div id="player-bike" class="vehicle">üèçÔ∏è</div>
                </div>
            </div>

            <div class="flex justify-between items-end mb-4 px-2">
                <div class="text-[9px] text-green-400">SCORE: <span id="current-score">0</span></div>
                <div class="text-[9px] text-yellow-400">LEVEL: <span id="current-level">1</span></div>
            </div>

            <div class="game-card p-6 md:p-10">
                <div class="timer-container">
                    <div id="timer-bar"></div>
                </div>
                <div id="question-text" class="text-xs md:text-sm mb-10 leading-relaxed text-center min-h-[80px] flex items-center justify-center px-4">
                    Ready?
                </div>
                <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
            </div>
        </div>
    </div>

    <!-- GAME OVER -->
    <div id="game-over-screen" class="screen text-center">
        <h1 class="text-5xl text-red-600 mb-8 arcade-text">BUSTED!</h1>
        <div class="game-card p-10 mb-10 w-full max-w-md">
            <p class="mb-6 text-sm">FINAL SCORE: <span id="final-score" class="text-green-400">0</span></p>
            <p id="game-over-reason" class="text-red-400 text-[10px] leading-relaxed"></p>
        </div>
        <button onclick="restartGame()" class="bg-white text-black px-12 py-6 hover:bg-gray-200 text-sm">REBOOT</button>
    </div>

    <div id="busted-flash" class="busted-flash">
        <h2 class="text-4xl text-white arcade-text">CAUGHT!</h2>
    </div>

    <script>
        // --- VOKABEL DATENBANK ---
        const vocabularyDB = [
            { q: "What is the English term for 'Pressekonferenz'?", a: "press conference", d: ["media briefing", "news session", "print report"], type: "translation" },
            { q: "To be present at or go to (an event/school):", a: "to attend", d: ["to visit", "to watch", "to expect"], type: "meaning" },
            { q: "Which verb means to provide money for a specific purpose?", a: "to fund", d: ["to found", "to find", "to fix"], type: "meaning" },
            { q: "The process of absorbing into a dominant culture:", a: "to assimilate", d: ["to isolate", "to differentiate", "to exclude"], type: "meaning" },
            { q: "Translate 'V√∂lkermord' into English:", a: "genocide", d: ["homicide", "suicide", "infanticide"], type: "translation" },
            { q: "The Christian faith / Christentum:", a: "Christianity", d: ["Christness", "Christendom", "Christianing"], type: "meaning" },
            { q: "A formal agreement between states or nations:", a: "treaty", d: ["law", "contract", "pact"], type: "meaning" },
            { q: "Meaning: Noticeable or important (e.g. change):", a: "significant", d: ["slight", "trivial", "random"], type: "meaning" },
            { q: "Translate: 'betr√§chtlich; erheblich'", a: "substantial", d: ["minor", "minimal", "fragile"], type: "translation" },
            { q: "To perform an act, typically a crime or a sin:", a: "to commit", d: ["to permit", "to admit", "to submit"], type: "meaning" },
            { q: "Translate: 'ausrotten; vernichten'", a: "to exterminate", d: ["to exclude", "to explore", "to exist"], type: "translation" },
            { q: "Information proving whether a belief is true:", a: "evidence", d: ["rumor", "theory", "opinion"], type: "meaning" },
            { q: "To be worthy of something due to actions:", a: "to deserve", d: ["to desire", "to serve", "to design"], type: "meaning" },
            { q: "A statement expressing regret for a fault:", a: "apology", d: ["excuse", "reason", "feeling"], type: "meaning" },
            { q: "Feeling or showing thanks:", a: "grateful", d: ["great", "graceful", "greedy"], type: "meaning" },
            { q: "To carry out an activity or a study:", a: "to conduct", d: ["to connect", "to conclude", "to confuse"], type: "meaning" },
            { q: "Translate: 'beharren; bleiben'", a: "to persist", d: ["to resist", "to exist", "to consist"], type: "translation" },
            { q: "To move a vehicle in a certain direction:", a: "to steer", d: ["to stare", "to stay", "to step"], type: "meaning" },
            { q: "Meaning: Irritated and frustrated to a high degree:", a: "exasperated", d: ["exhausted", "excited", "exaggerated"], type: "meaning" },
            { q: "A dark mark on skin caused by a hit:", a: "bruise", d: ["break", "blood", "burn"], type: "meaning" },
            { q: "To cry with noisy, short breaths:", a: "to sob", d: ["to sigh", "to sing", "to smile"], type: "meaning" },
            { q: "Translate: 'besch√§mend; sch√§ndlich'", a: "shameful", d: ["shadowy", "famous", "shaking"], type: "translation" }
        ];

        // --- SPIEL VARIABLEN ---
        let score = 0;
        let highscore = localStorage.getItem('vocaChaseHighscore') || 0;
        let isMuted = false;
        let gameActive = false;
        
        // Timer Variablen
        let startTime = 0;
        const DURATION = 5000; // 5 Sekunden
        let animationFrameId = null;

        // Positionen (in %)
        const POLICE_START_X = 5;
        const TARGET_X = 80; // Dort ist das Motorrad

        // Audio Kontext
        let audioCtx = null;
        let masterGain = null;

        // --- CORE FUNCTIONS ---
        function init() {
            document.getElementById('display-highscore').innerText = highscore;
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id + '-screen').classList.add('active');
        }

        function startGame() {
            initAudio();
            score = 0;
            updateScoreUI();
            showScreen('game');
            gameActive = true;
            document.getElementById('road-element').classList.remove('paused');
            nextQuestion();
        }

        function nextQuestion() {
            const q = vocabularyDB[Math.floor(Math.random() * vocabularyDB.length)];
            document.getElementById('question-text').innerText = q.q;
            
            const options = [...q.d, q.a];
            for (let i = options.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [options[i], options[j]] = [options[j], options[i]];
            }
            
            const grid = document.getElementById('options-grid');
            grid.innerHTML = '';
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'btn-option';
                btn.innerText = opt;
                btn.onclick = (e) => {
                    e.preventDefault();
                    if(gameActive) checkAnswer(opt, q.a);
                };
                grid.appendChild(btn);
            });

            startTimer();
        }

        // --- TIMER & MOVEMENT ENGINE ---
        function startTimer() {
            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            startTime = performance.now();
            tick();
        }

        function tick() {
            if (!gameActive) return;

            const now = performance.now();
            const elapsed = now - startTime;
            const progress = Math.min(elapsed / DURATION, 1);

            // 1. Timer Balken Update
            const timerBar = document.getElementById('timer-bar');
            timerBar.style.transform = `scaleX(${1 - progress})`;
            
            // Farben: Gr√ºn -> Gelb -> Rot
            if (progress < 0.5) timerBar.style.background = '#00ff00';
            else if (progress < 0.8) timerBar.style.background = '#ffff00';
            else timerBar.style.background = '#ff0000';

            // 2. Polizei Bewegung (Lineare Ann√§herung)
            // Start: 5%, Ende: 80% (Crash)
            const currentPoliceX = POLICE_START_X + (TARGET_X - POLICE_START_X) * progress;
            document.getElementById('police-car').style.left = currentPoliceX + '%';

            if (progress >= 1) {
                gameOver("THE POLICE RAMMED YOUR BIKE! SPEED UP YOUR THINKING.");
            } else {
                animationFrameId = requestAnimationFrame(tick);
            }
        }

        function checkAnswer(selected, correct) {
            if (selected === correct) {
                playNote(523, 'sine', 0.1); 
                const now = performance.now();
                const bonus = Math.floor((DURATION - (now - startTime)) / 50);
                score += 100 + Math.max(0, bonus);
                updateScoreUI();
                nextQuestion();
            } else {
                playNote(110, 'sawtooth', 0.3); 
                gameOver("WRONG MOVE! YOU LOST CONTROL OF THE BIKE.");
            }
        }

        function updateScoreUI() {
            document.getElementById('current-score').innerText = score;
            document.getElementById('current-level').innerText = Math.floor(score / 1000) + 1;
        }

        function gameOver(reason) {
            gameActive = false;
            cancelAnimationFrame(animationFrameId);
            document.getElementById('road-element').classList.add('paused');
            document.getElementById('busted-flash').style.display = 'flex';
            
            setTimeout(() => {
                document.getElementById('busted-flash').style.display = 'none';
                showScreen('game-over');
                if (score > highscore) {
                    highscore = score;
                    localStorage.setItem('vocaChaseHighscore', highscore);
                    document.getElementById('display-highscore').innerText = highscore;
                }
                document.getElementById('final-score').innerText = score;
                document.getElementById('game-over-reason').innerText = reason;
            }, 800);
        }

        function restartGame() { startGame(); }

        // --- AUDIO ENGINE ---
        function initAudio() {
            if (audioCtx) return;
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            masterGain = audioCtx.createGain();
            masterGain.connect(audioCtx.destination);
            masterGain.gain.value = 0.08;
            
            // Bass Loop
            setInterval(() => {
                if (gameActive) {
                    playNote(82.41, 'triangle', 0.15, 0.5); // E
                    setTimeout(() => playNote(73.42, 'triangle', 0.1, 0.3), 200); // D
                }
            }, 400);
        }

        function playNote(freq, type, duration, vol = 0.5) {
            if (isMuted || !audioCtx) return;
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            g.gain.setValueAtTime(vol, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
            osc.connect(g);
            g.connect(masterGain);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function toggleAudio() {
            isMuted = !isMuted;
            document.getElementById('audio-toggle').innerText = isMuted ? "üîá AUDIO: OFF" : "üîä AUDIO: ON";
        }

        init();
    </script>
</body>
</html>
